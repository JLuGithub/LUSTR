A typical pipeline to run LUSTR:

(0) Prepare the reference genome/sequences/contigs etc. For each pair-end short read sequenced sample to be genotyped, prepare the raw read pairs as .fastq format. In the situation where raw reads were unavailable, users may use LUSTR_Extractor.pl or other existing tools such as samtools to extract raw read pairs from .sam/.bam files.

(1.1) Prepare a file containing basic information of the STRs of interest on the reference. The file can be generated either manually or translated from results processed by existing tools such as TandemRepeatFinder. The file shall contain lines for each STR with following columns separated by space:
	Column 1: ID of the STR (no space included);
	Column 2: Chromosome or segment name (identical to the names in the reference) where the STR is located;
	Column 3 & 4: A region indicated by starting and ending position to initiate STR searching. Noting that the region can be imperfect and will be used to search for STR seeds and initiate repeat extension;
	Column 5: Sequence of the repetitive unit of the STR.
	Sample: STR_sample1 chr23 150 200 ACG
(1.2) Use LUSTR_Finder.pl to process the STR information file from Step (1.1) against the reference, to obtain standarized sequences of the repeat and flanking regions of each STR of interest as well as other information for subsequent steps. The output file format will be (and should be, if user makes modifications such as customization or combination) plain text containing one line of general information, and then groups of eight lines for each STR, as follows:
	Line 1: Information of the STR
	Line 2 & 3: Sequence of the repeat region of the STR (from the positive strand according to the reference)
	Line 4 & 5: Sequence of the upstream flanking region of the STR (from the positive strand as well)
	Line 6 & 7: Sequence of the downstream flanking region of the STR (from the positive strand as well)
	Line 8: A blank line to separate

(2) Use LUSTR_RefCreator.pl to generate fasta format file from the STR sequences obtained in Step (1.2). The fasta file will serve as the reference to remap raw read pairs to both flanking and repeat sequences. The remapping can be done by existing tools such as bowtie or bwa, but an output in .sam or .bam format without location sorting is required. The parameters for the remapping shall work for pair-end reads and be optimized for STRs. For example, the output may want to contain all mapped hits, without excluding unmapped reads, prefer clips to INDELs, and so forth. Giving bwa mem as an example, besides all other default settings, -a is necessary to export all hits, -D 0.01 -P is strongly recommend to have best results for overlapping STRs, and -T may need to be adjusted when read length is shorter than 100nt.

(3) According to the STR sequences obtained in Step (1.2), use LUSTR_Realigner.pl to process the remapped .sam/.bam files obtained in Step (2) to realign the read pairs to each STR locus. The output file will be plain text containing two header lines for general information and one blank header line to separate, followed by lines for each STR. The lines for each STR locus include one line for the information of the STR, one line indicating the pair number being realigned, several lines for the realignment details of each pair, and one blank line to separate. Each realignment line contains the ID of the pair, and paired "{}" for read 1 and read 2 for their realigned lengths to the upstream flank, the repeat, and the downstream flank, separated by commas ",". In case when the pair can be realigned in multiple ways, multiple paired "{}" will be shown, separated by spaces.

(4) Use LUSTR_Caller.pl to process the realignment results obtained in Step (3). The output file will be plain text containing a brief format instruction, followed by estimations of each STR. For each STR it will contain a header line for the information, followed by lines of all estimated alleles showing size, reliability, and allele fraction. For allele type, "D" indicates a size shorter than read length and can be directly called, "I" indicates a size longer than read length estimated by pairs overlapping with the flanking sequences, "I+" indicates an alternative estimation of "I" but includes pairs with only repeat sequences. An warning log file will also be generated to indicate detection of evidences to potential offtargets, mutations close to STR boundaries, and duplicates filteration. Noting that if the library is composed by reads with largely varied lengths, a warning message will be given and the results can be affected.
